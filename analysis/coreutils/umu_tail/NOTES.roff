.\" NOTES.roff - design notes for umu_tail
.\" 日本語の設計メモ（roff）
.TH UMU_TAIL_NOTES 7 "2026-01-02" "UmuOS" "設計ノート"

.SH 概要
この文書は、\fBumu_tail\fP を「最低限動く」水準まで削ぎ落とした際の
設計判断、削除した機能、参照元（GNU coreutils の tail 実装）との差分思想をまとめる。

.SH 設計判断（理由）
.IP \[bu] 2
\fB最小仕様を固定\fP: まず「末尾 N 行」を核として成立させる（デフォルト 10 行）。
.IP \[bu] 2
\fB-n のみ実装\fP: 実用性を確保しつつ仕様の分岐を最小にする。
`-f`（追従）や `-c`（バイト数）、`+N` 形式は別の設計課題を持つため切り離す。
.IP \[bu] 2
\fBストリーム対応を優先\fP: stdin のように seek できない入力でも動くよう、
「最後の N 行だけ保持する」リングバッファ方式を採用する。
（大規模ファイルを高速に処理する最適化は、本分析の範囲外。）
.IP \[bu] 2
\fB自己完結\fP: gnulib/coreutils の共通部を使わず、標準的な POSIX API（getline 等）で完結させる。
.IP \[bu] 2
\fB慣習の継承\fP: `-` を標準入力として扱う規約は残す。

.SH 削った機能一覧
.TP
\fB-f（追従）\fP
イベント待ちやリトライ、ファイルローテーション等の設計が必要なため未実装。
.TP
\fB-c（バイト数指定）\fP
行単位と異なる仕様になるため未実装。
.TP
\fB+N 形式\fP
「先頭から数えて N 行目以降」等の別仕様になるため未実装。
.TP
\fB高速化・最適化\fP
seek を用いた後方探索、ブロック読み、mmap 等。
最小版では“読めること”を優先して未実装。
.TP
\fB--help/--version と i18n\fP
最小版では依存と読解コストが大きいので切り離す。

.SH 参照元（coreutils tail.c）との差分思想
.IP \[bu] 2
\fBストリームで成立する核を先に作る\fP:
coreutils 版は高機能ゆえに分岐が多い。まず stdin でも成立する核を独立させ、
必要になったら最適化・追従等の層を戻す。
.IP \[bu] 2
\fB仕様は man、理由は NOTES\fP:
実装を短く保ち、読者が仕様と意図を別々に辿れるようにする。

.SH 今後拡張するなら
.IP \[bu] 2
`--help/--version`
.IP \[bu] 2
seek 可能な通常ファイルでの高速化（後方探索）
.IP \[bu] 2
`-f`（追従）: 仕様（ローテーションや停止条件）を先に文章化してから
