.\" NOTES.roff - design notes for umu_echo
.\" 日本語の設計メモ（roff）
.TH UMU_ECHO_NOTES 7 "2026-01-02" "UmuOS" "設計ノート"

.SH 概要
この文書は、\fBumu_echo\fP を「コマンドが最低限動く」水準まで削ぎ落とした際の
設計判断、削除した機能、参照元（GNU coreutils の echo 実装）との差分思想をまとめる。

.SH 設計判断（理由）
.IP \[bu] 2
\fB自己完結\fP: `config.h` や gnulib などの外部依存を排除し、単一の C ファイルで完結させる。
学習用途では、依存の層が厚いほど「何が本質か」が見えにくくなるため。
.IP \[bu] 2
\fB本質優先\fP: echo の核は「引数列を空白で連結して出す」こと。
互換性のための特殊挙動は、本質を理解した後で足す方が理解しやすい。
.IP \[bu] 2
\fB仕様を小さく固定\fP: 互換性の議論（POSIX/System V/bash/coreutils）は際限がない。
本分析では、まず最小仕様（\fB-n\fP だけ）を固定し、そこから増やす判断材料を残す。
.IP \[bu] 2
\fB文化的に“正統派”な分離\fP: 仕様は man に、設計理由や非対応一覧は NOTES に置く。
実装ファイルに長文の説明を抱え込まず、読者が目的に応じて辿れる構造にする。

.SH 削った機能一覧
.PP
参照元の coreutils 版が持つ（または一般的な echo が持つ）機能のうち、\fBumu_echo\fP では以下を削除した。

.TP
\fB-i18n/ロケール対応\fP
`setlocale`、`bindtextdomain`、`textdomain` 等。
学習用途では入出力の核と無関係で、依存と読解コストが大きい。

.TP
\fB--help/--version\fP
ヘルプ生成、バージョン表示、著者情報、付帯情報の出力。
ユーティリティとしては重要だが、エコー処理の核ではない。

.TP
\fB-e / -E とバックスラッシュエスケープ解釈\fP
`\en` 等の解釈、`\ec` による早期終了、8/16進の解釈など。
挙動の互換性が複雑で、echo の“罠”として有名な領域。
最小版では実装しない。

.TP
\fBPOSIXLY_CORRECT による分岐\fP
環境変数でオプション解釈の可否を切り替える流儀。
移植・理解の負担が大きいので一旦落とす。

.TP
\fBオプションの網羅的パース\fP
`-neE` のような結合オプション、無効オプションが出た時のフォールバックなど。
最小版では `-n` のみを先頭 1 個だけ解釈する。

.TP
\fBclose_stdout 等の終了時処理\fP
coreutils 流の安全な stdout クローズ処理。
最小版では標準 C の範囲に留める。

.SH 参照元（coreutils echo.c）との差分思想
.IP \[bu] 2
\fB互換性の負債を“最初から背負わない”\fP: coreutils 版は多数の歴史的挙動を吸収し、
シェル組み込みや他実装との違いも踏まえた分岐を持つ。
一方で学習の入口としては情報量が多すぎるため、まず最小核のみを確立する。
.IP \[bu] 2
\fB「正しく出力する」より「何を実装していないかを明示する」\fP:
echo は実装差が問題になりやすいコマンドなので、
“非対応”を man/NOTES に明記し、利用側に期待を持たせないことを優先する。
.IP \[bu] 2
\fBprintf 推奨の文化を踏襲\fP:
Linux/UNIX 圏では、オプション風文字列やエスケープが絡む出力は \fBprintf(1)\fP を使うのが定石。
最小 echo はその前提に寄り添い、複雑さを引き受けない。

.SH 今後拡張するなら
.PP
互換性が必要になった場合、以下の順で追加すると衝突が少ない。
.IP \[bu] 2
`-n` の繰り返し許可（`-n -n` や `-nnn` などの扱いを決める）
.IP \[bu] 2
`--` の解釈（オプション終端）
.IP \[bu] 2
`-e` とエスケープ解釈（ただし仕様・互換の落とし所を先に文章化する）
.IP \[bu] 2
`--help/--version` とロケール
