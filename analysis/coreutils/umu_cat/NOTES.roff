.\" NOTES.roff - design notes for umu_cat
.\" 日本語の設計メモ（roff）
.TH UMU_CAT_NOTES 7 "2026-01-02" "UmuOS" "設計ノート"

.SH 概要
この文書は、\fBumu_cat\fP を「最低限動く」水準まで削ぎ落とした際の
設計判断、削除した機能、参照元（GNU coreutils の cat 実装）との差分思想をまとめる。

.SH 設計判断（理由）
.IP \[bu] 2
\fB自己完結\fP: gnulib/coreutils の補助関数（`safe-read`/`full-write` など）や `config.h` を排除し、
単一 C ファイルでビルドできるようにする。UmuOS の最小ユーザーランドを作る上で、
依存を減らすこと自体が目的になる。
.IP \[bu] 2
\fBバイト列コピーに集中\fP: cat の核は「入力をそのまま stdout に流す」こと。
表示整形（行番号、不可視文字、$ 表示等）は“cat の周辺”であり、まず本質と切り離す。
.IP \[bu] 2
\fBUNIX 文化の慣習を採用\fP: `-` を標準入力として扱う規約は、多数のコマンドで通用する。
最小版でもここは残すと、パイプやフィルタの例が作りやすい。
.IP \[bu] 2
\fB堅実な失敗\fP: 読み取り・書き込みエラー時は `stderr` に原因を出し、終了ステータスを 1 にする。
機能は小さくても、失敗時の振る舞いはツールとして重要。

.SH 削った機能一覧
.PP
参照元の coreutils 版が持つ機能のうち、\fBumu_cat\fP では以下を削除した。

.TP
\fB表示オプション一式\fP
`-n`/`-b`/`-s`/`-v`/`-E`/`-T`/`-A` 等。
学習用途では分岐と状態管理が増え、I/O の本質が見えにくくなるため。

.TP
\fB低レベル I/O と最適化\fP
ブロックサイズ推定、`ioctl(FIONREAD)`、アライン確保、`posix_fadvise` 等。
性能上は価値があるが、最小版では実装・移植負担が大きい。

.TP
\fB--help/--version と i18n\fP
ヘルプ・バージョン出力、翻訳、エラー整形の共通化。
解析の入口としては依存の層が厚いため、切り離す。

.TP
\fBバイナリ I/O 設定や互換層\fP
環境差分（特に非 POSIX 環境）を吸収するための層。
本プロジェクトの前提を Linux に寄せ、まず不要にする。

.SH 参照元（coreutils cat.c）との差分思想
.IP \[bu] 2
\fB「最小ユーティリティ」と「汎用ユーティリティ」は別物\fP:
coreutils は“あらゆる環境・ユースケース”を扱うため、互換・最適化・表現力を積み上げる。
UmuOS の解析では、まず「動くこと」「読めること」を優先し、必要になったら層を戻す。
.IP \[bu] 2
\fBオプションを増やす前に文章化\fP:
cat の表示オプションは相互作用が多い。
拡張する場合は、man/NOTES に仕様を先に書き、実装が仕様に従う形にする。

.SH 今後拡張するなら
.PP
必要性が出た順に、以下のように段階的に戻すのが安全。
.IP \[bu] 2
`--help/--version`（仕様提示の最小限）
.IP \[bu] 2
`-n`（行番号）: まずは単独で実装し、`-b` との関係は後で決める
.IP \[bu] 2
`-s`（空行圧縮）: 状態管理が増えるので仕様を先に固める
.IP \[bu] 2
`-v`/`-E`/`-T`（可視化）: 互換性と期待値を文章化してから実装
