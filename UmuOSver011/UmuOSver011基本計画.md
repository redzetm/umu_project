# UmuOSver0.1.1の基本計画
以下の機能を実装する
- 電源投入からUEFI起動し、Linuxカーネル6.18.1 を利用し、設定はデフォで起動
- 自作init（C言語で実装）※init.cを見直し、処理をシンプルにする。（AIと相談する）
- login IDとpasswordでログイン（ユーザーは、rootユーザー、tamaユーザーの2名）
- 一応はマルチユーザー仕様
- ext4ファイルシステムを搭載し、揮発性RAM環境からの脱却
- ext4ファイルシステムは、/ に実装し、ver0.1の/persistや/home以下のみ
  保存できるといった、揮発性との混在環境をなくす。すべて / にマウントする。
- 自宅サーバーの仮想マシンマネージャから.isoを読み込み、起動できる仕様
- 開発環境でQEMUを利用し、qemu-system-x86_64コマンドで、テスト起動できること。
- telnetで接続できるようにする
- ログを/logsに永続出力できるようにする（少なくとも起動ログ）
- DHCPは使わず、静的IPアドレスで動くようにする。IP 192.168.0.204/24 defaultGW 192.168.0.1 DNS 8.8.8.8

※ver0.1の不具合修正のほか、上記の機能を安定的に稼働できるようにする。ver0.1.1とする。
　ver0.1.1は、安定版としてver0.2以降のBusyBoxコマンドからの脱却を行うベースバージョンとする。

### ver0.1の不具合一覧
- ext4ファイルシステムは、/ に実装し、ver0.1の/persistや/home以下のみ
  保存できるといった、揮発性との混在環境をなくす。すべて / にマウントする。
- / にマウントできていないからipコマンドでネットワーク設定しても再起動すると設定が消える
- 不具合ではないが、init.cを何回も書き換えたため、複雑化しているので、再度チェックし、コードを最適化する。

### 方針（0.1.1で決めること）
- ext4の/は、仮想ディスクを作って永続化する（ISO内イメージのループマウントは採用しない）
- ISOは「ブートローダ + kernel + initramfs」を提供し、永続データは仮想ディスク側に持つ仕様とする。
- ブート手順は initramfs →（自作init）→ ext4を/としてマウント → switch_root（0.1.1ではBusyBox実装を利用する）
- ver0.1は参照して要件/落とし穴を学ぶが、コード/設定の流用（コピペ）はせずに再構成する（再現性重視）
- ローカル環境のQEMU起動は任意のテスト用途とし、本番は自宅サーバーのQEMU-KVM環境を優先して設計する

### BusyBoxの扱い（段階的に脱却する）
- 0.1.1では、安定化を優先しBusyBoxの利用を許容する（echo/ls/cat等を含む）
- ただし、利用範囲は固定化する（使うアプレットを明確化し、将来の置換対象をリスト化する）
- 0.2以降で、起動・ログイン・ネット初期化など「OSの芯」から置換していく

### 検討事項は、以下にレビューで決定した。
- ext4を/として使う際のデバイス特定方法：初期からUUID指定とする（QEMU/virt-manager差異に強く、再現性を上げる）
- switch_rootの呼び出し方法：0.1.1ではBusyBox実装を利用し、自作init側の前後処理を最小にする
- loginの実装方針：ver0.1と同じくBusyBox（getty/login相当）を利用する。0.2以降で置換を検討する
- telnet提供の前提：ver0.1と同じくBusyBoxのtelnetdを利用する。switch_root後（ext4の/に移行後）に起動し、BusyBoxのloginで認証する（/etc/passwd, /etc/shadowをext4側に配置）。運用はLAN内の開発用途を前提とし、必要時のみ有効化する

### 成功条件（受入基準）
- 再起動後も、/配下のファイル変更・ユーザー情報・ネットワーク設定が保持される
- QEMUと自宅サーバー（仮想マシンマネージャ）の両方で、同一ISOから起動できる
- telnetで接続し、login（root/tama）できる
- /logsに起動ログ（例：boot.log）を出力でき、再起動後もログが保持される



202512211634

