# 実装ノート

- ここでは、UmuOS ver0.1.1 の実装過程で発生した注意点・判断理由・ハマりポイントを記載する
- 詳細設計書には書かれていない「実装時の思考」「なぜその実装を選んだのか」を残すことを目的とする
- 将来 ver0.2 以降で実装を置き換える際の判断材料としても利用する
- コードそのものの説明ではなく、「設計と実装のズレ」「実装して初めて分かったこと」を重視する
- 不明点や調査は、WEBやCopilot、Github Copilotと相談して進める方式
- **<重要> ただ起動して成功ではない。メカニズムを理解することを最重要とする**


## 開発環境と実行環境

- 開発環境  
  - MiniPC MEM32GB  
  - CPU: 12th Gen Intel(R) Core(TM) i9-12900HK (2.50 GHz)
  - OS: Windows 11 Pro 25H2  
  - エディタ: Visual Studio Code 1.107.1

- 開発形態  
  - Windows 環境から、自宅サーバー（ProxmoxVE9.1.1）上の Ubuntu 24.04 LTS に SSH 接続して開発
  - ビルド・ISO 作成・ディスク操作は Ubuntu 側で実施する

- 実行環境  
  - 自宅サーバー: Xeon / MEM32GB  OS　ProxmoxVE9.1.1
  - 仮想化基盤: QEMU-KVM  
  - GUI 管理ツール: ProxmoxVE9.1.1（WEBによるGUI）、基本CLIを利用

- UmuOS ver0.1 では、CentOS Stream9の仮想マシンマネージャから起動することを前提とした設計とした
  - ver0.1.1からは、開発環境であるUbuntu24.04LTS環境でのQEMU環境でシリアル（ttyS0）での起動を前提とする

---

## 1. UmuOSver011詳細設計を実装した場合の成果物一覧
### プロジェクト内（~/umu/umu_project/UmuOSver011 配下）

- ドキュメント
  - `UmuOSver011基本計画.md`
  - `docs/UmuOSver011詳細設計.md`
  - `docs/実装ノート.md`

- kernel（ソースと成果物）
  - `kernel/linux-6.18.1/`（取得したカーネルソース）
  - `iso_root/boot/vmlinuz-6.18.1`
  - `iso_root/boot/config-6.18.1`

- initramfs（移行専用）
  - `initramfs/src/init.c`（自作 init）
  - `initramfs/rootfs/`（cpio生成元）
  - `initramfs/initrd.img-6.18.1`（生成物）
  - `iso_root/boot/initrd.img-6.18.1`（ISOに格納するコピー）

- GRUB/ISO（ブート資産）
  - `iso_root/boot/grub/grub.cfg`
  - `UmuOSver011-boot.iso`

- 永続ディスク（最終的な /）
  - `disk/disk.img`（パーティション無しの ext4）

- QEMU実行用ファイル
  - `run/OVMF_VARS_umuos011.fd`

### disk.img 内（ext4 ルートの主要ファイル）

- init
  - `/sbin/init`（`/bin/busybox` への symlink を想定）
  - `/etc/inittab`
  - `/etc/init.d/rcS`

- ユーザー/認証
  - `/etc/passwd`
  - `/etc/shadow`
  - `/etc/securetty`（rootログインが拒否される場合のみ）
  - `/home/tama/`（所有者 `1000:1000` を想定）

- ネットワーク（静的）
  - `/etc/umu/network.conf`
  - `/etc/resolv.conf`（rcS が DNS を設定した結果）

- ログ（永続）
  - `/logs/boot.log`

### 開発マシン側（システム設定：必要時のみ）

- ブリッジ設定
  - `/etc/netplan/01-br0.yaml`

- QEMU bridge helper 設定
  - `/etc/qemu/bridge.conf`
