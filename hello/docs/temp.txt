ãªã‚“ã¦ã‚‚ä¸€æ™‚ä¿å­˜

ã€Œã‚·ã‚§ãƒ«ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦èµ·å‹•ã™ã‚‹ã€ã ã‘ã§ã¯ãªãã€å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸãƒã‚¤ãƒŠãƒªï¼ˆBIOSé¢¨ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’ QEMU ã«é£Ÿã‚ã›ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§é€²ã‚ã‚‹ã®ãŒæœ¬ç­‹ã§ã™ã€‚

########################################


ğŸ›  QEMUç’°å¢ƒã®æº–å‚™æ‰‹é †
1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Ubuntuç’°å¢ƒãªã‚‰ä»¥ä¸‹ã‚’å…¥ã‚Œã¦ãŠãã¨å®‰å¿ƒã§ã™ï¼š
sudo apt update
sudo apt install qemu-system-x86 nasm grub-pc-bin mtools parted


- qemu-system-x86 : ä»®æƒ³ãƒã‚·ãƒ³æœ¬ä½“
- nasm : ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚’ãƒã‚¤ãƒŠãƒªåŒ–ã™ã‚‹ãŸã‚
- grub-pc-bin : BIOSç‰ˆGRUBã‚’ãƒ‡ã‚£ã‚¹ã‚¯ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚
- mtools/parted : ãƒ‡ã‚£ã‚¹ã‚¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆã‚„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ“ä½œç”¨

2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
ä¾‹ã¨ã—ã¦ï¼š
umu/
 â”œâ”€ src/        ï¼ˆã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚„Cã‚³ãƒ¼ãƒ‰ï¼‰
 â”œâ”€ build/      ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ãƒã‚¤ãƒŠãƒªï¼‰
 â”œâ”€ disk/       ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
 â””â”€ scripts/    ï¼ˆè£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰



3. BIOSé¢¨ã‚³ãƒ¼ãƒ‰ã®ãƒ“ãƒ«ãƒ‰
src/umu_bios.asm ã‚’æ›¸ã„ã¦ã€NASMã§ãƒã‚¤ãƒŠãƒªåŒ–ã—ã¾ã™ï¼š
nasm -f bin src/umu_bios.asm -o build/umu_bios.bin



4. GRUBã‚’å…¥ã‚ŒãŸãƒ‡ã‚£ã‚¹ã‚¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ
ãƒ‡ã‚£ã‚¹ã‚¯ä½œæˆ
dd if=/dev/zero of=disk/disk.img bs=1M count=64


ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ä½œæˆã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
sudo losetup -fP disk/disk.img
LOOPDEV=$(sudo losetup -a | grep "disk.img" | awk -F: '{print $1}')

sudo parted -s $LOOPDEV mklabel msdos
sudo parted -s $LOOPDEV mkpart primary ext2 1MiB 100%
sudo mkfs.ext2 ${LOOPDEV}p1


GRUBã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mkdir -p disk/mnt
sudo mount ${LOOPDEV}p1 disk/mnt
sudo grub-install --target=i386-pc --boot-directory=disk/mnt/boot $LOOPDEV


GRUBè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
sudo mkdir -p disk/mnt/boot/grub
echo 'set timeout=5
menuentry "Umu hello" { echo "GRUBèµ·å‹•æˆåŠŸ"; }' | sudo tee disk/mnt/boot/grub/grub.cfg
sudo umount disk/mnt
sudo losetup -d $LOOPDEV

î·™î·š

5. QEMUã§èµ·å‹•
qemu-system-x86_64 \
  -bios build/umu_bios.bin \
  -drive file=disk/disk.img,format=raw


- ã¾ãšã€ŒUmu BIOS v0.1ã€ãªã©ã®æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãã®å¾Œã€GRUBãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå‡ºã‚Œã°æˆåŠŸ

ğŸ¯ ã¾ã¨ã‚
- QEMUç’°å¢ƒã¯ qemu-system-x86 ã‚’å…¥ã‚Œã‚‹ã ã‘ã§OK
- BIOSé¢¨ã‚³ãƒ¼ãƒ‰ã‚’NASMã§ãƒã‚¤ãƒŠãƒªåŒ–ã—ã€-bios ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§èª­ã¿è¾¼ã¾ã›ã‚‹
- GRUBã¯ grub-install ã§ãƒ‡ã‚£ã‚¹ã‚¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å…¥ã‚Œã¦ãŠã
- èµ·å‹•ã™ã‚‹ã¨ã€ŒUmu BIOS â†’ GRUBãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã¨ã„ã†æµã‚ŒãŒå†ç¾ã§ãã‚‹

########################################


====================
     Umu Project
====================

########################################





