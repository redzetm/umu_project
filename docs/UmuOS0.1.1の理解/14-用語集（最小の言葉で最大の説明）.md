# 14-用語集（最小の言葉で最大の説明）

本書は「UmuOS 0.1.1 を説明できる理解」に到達するための教科書である。
説明できる理解とは、言い換えれば **短い言葉で、長い現象を再構成できる**状態だ。

この章は、そのための最小用語集である。
本書で繰り返し登場する言葉を、UmuOS 0.1.1 の範囲に限定して定義する。

---

## UEFI

PC の起動ファームウェア規格である。
UmuOS 0.1.1 は UEFI ブートを前提にし、QEMU 上では OVMF を通して UEFI を実現している。
本書において UEFI は「GRUB を起動する入り口」である。

## OVMF

QEMU 上で UEFI を提供するためのファームウェア実装（EDK2 系）である。
UmuOS 0.1.1 では `OVMF_CODE`（ファーム本体）と `OVMF_VARS`（NVRAM 相当）を QEMU に渡して起動する。
`VARS` は起動中に更新されるため、`run/` にコピーして使う運用が採られている（第11章）。

## GRUB

ブートローダである。
UmuOS 0.1.1 では ISO 内の GRUB が kernel と initrd をロードし、
さらに `root=UUID=...` などのカーネル引数を渡す。

## カーネル引数（kernel cmdline）

GRUB が Linux kernel に渡す文字列であり、kernel はそれを `/proc/cmdline` として見せる。
UmuOS 0.1.1 の `/init` はこの入力を読むことで、永続 root を決定する（第7章）。

## `root=UUID=...`

最終的に `/`（root ファイルシステム）にする対象を、UUID で指定するためのカーネル引数である。
UmuOS 0.1.1 では、これは disk.img（ext4）の UUID を指す。
UUID がズレると `/init` は永続 root を見つけられない（第9章）。

## initrd / initramfs

起動直後に kernel が展開して使う“最初のユーザー空間”である。
UmuOS 0.1.1 では initramfs に自作の `/init` を入れ、永続 root へ移行するための橋渡しに使う。

## `/init`

initramfs 内で最初に起動されるプログラムで、PID 1 になる。
UmuOS 0.1.1 の `/init` は「root=UUID を解釈し、disk.img を見つけて mount し、switch_root する」ことに専念する（第7章）。

## PID 1

ユーザーランドで最初に起動されるプロセスの番号である。
PID 1 は子プロセスの管理とシステム全体の挙動（再起動など）に強い影響を持つ。
UmuOS 0.1.1 では、initramfs 段階では `/init`、永続 root 段階では `/sbin/init` が PID 1 になる（第8章）。

## `switch_root`

initramfs から永続 root へ、`/`（root ファイルシステム）を切り替えるための仕組みである。
UmuOS 0.1.1 は BusyBox の `switch_root` を使い、`exec` により PID 1 の実体も差し替える。
これが成立すると、以後の世界の前提（ファイルの場所）が ext4（disk.img）基準に切り替わる（第8章）。

## 永続 root / disk.img

UmuOS 0.1.1 の最終 `/` になる ext4 ファイルシステムである。
ホスト上の 1 ファイル `disk/disk.img` として管理され、QEMU には virtio-blk として接続される（第9章）。

## ext4 superblock

ext4 ファイルシステムのメタデータの中核で、UUID などの情報を保持している。
UmuOS 0.1.1 の `/init` は、udev や `blkid` に依存せず、superblock を直接読んで UUID を比較する。

## devtmpfs / `/dev`

`/dev` はデバイスファイルが並ぶ場所で、ブロックデバイス（例：`/dev/vda`）もここに現れる。
UmuOS 0.1.1 の `/init` は `/dev` を走査して ext4 を探すため、devtmpfs が成立していることが重要になる（第5章）。

## virtio-blk

QEMU が提供する準仮想化ブロックデバイスであり、ゲストでは `/dev/vda` のように見える。
UmuOS 0.1.1 は disk.img を `if=virtio` で接続し、virtio-blk を前提に起動経路を固めている。

## BusyBox

多数の Unix コマンドと init 機能を 1 バイナリにまとめたツールである。
UmuOS 0.1.1 は、initramfs と永続 root の両方で BusyBox を基盤として使う。

## BusyBox applet

BusyBox の各機能（`sh` や `init` や `switch_root` など）を、symlink として提供する仕組みである。
UmuOS 0.1.1 では applet の生成を **必ず chroot して行う**方針が重要になる（第9章・第13章）。

## chroot

あるディレクトリを `/` とみなしてプロセスを実行する仕組みである。
UmuOS 0.1.1 では、disk.img をホストで mount した後、
その中で BusyBox applet を生成する際に chroot を使い、symlink 破損（ホスト絶対パス混入）を避ける。

## loop mount

通常ファイル（ここでは disk.img）をブロックデバイスのように扱い、mount する方法である。
UmuOS 0.1.1 では disk.img の中身をホスト側で観測するために使う（第9章）。

## `/sbin/init`

永続 root へ `switch_root` した後の PID 1 である。
UmuOS 0.1.1 では BusyBox init に向けられる。
この init が `inittab` を読み、rcS を実行し、getty を起動する（第8章）。

## `/etc/inittab`

BusyBox init の“台本”であり、どの初期化を実行し、どの端末に getty を出すかを定義する。
UmuOS 0.1.1 では ttyS0 の getty を `respawn` することが、観測（ログイン）を成立させる鍵になる（第8章）。

## `rcS`

`inittab` の `::sysinit:` で呼ばれる最初の初期化スクリプトである。
UmuOS 0.1.1 では proc/sys/dev/devpts を mount し、必要なら永続ログへ追記し、観測点へ到達する。

## ttyS0 / シリアル観測

QEMU のシリアルポートで、ホストの端末に結びつけられる。
UmuOS 0.1.1 は「見える起動」を重視し、GRUB から kernel、/init、login までを ttyS0 で観測できるようにする（第11章）。

---

## まとめ

この用語集の目的は「言葉の圧縮」である。

- `root=UUID` と言ったら「disk.img の ext4 UUID を GRUB から `/init` へ渡す入力」
- `switch_root` と言ったら「`/` と PID 1 を永続 root 側へ切り替える境界」

のように、本書全体の説明を短い言葉で再構成できるようになる。
