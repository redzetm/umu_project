# 1-成果物の一覧と役割（UmuOS 0.1.1）

この章では、UmuOS 0.1.1 を構成する「成果物（生成物）」を列挙し、
それぞれが **起動シーケンスのどこで使われ、誰が消費するのか** を整理する。

狙いは「ファイルは見えるが、役割が曖昧」という状態をなくし、
後続の章（起動フロー、rcS、early userspace、設計判断）を読むための地図にすること。

---

## 全体像（誰が何を読むか）

大づかみに言うと、関係者は次の3者。

- ホスト側（開発環境）
  - `qemu-system-x86_64`、OVMF(UEFI)、ビルド済みの ISO / disk.img を用意して起動する
- ブートローダ（GRUB）
  - ISO 内の kernel + initrd をロードして Linux カーネルへ制御を渡す
- Linux カーネル + early userspace（initramfs）
  - initramfs の `/init` を実行して、永続ディスクを root に切り替え、ユーザーランドへ繋ぐ

---

## 起動に必要な成果物（最重要）

### 1) ブートISO

- パス: `UmuOS-0.1.1/UmuOS-0.1.1-boot.iso`
- 役割: 起動媒体（GRUB + kernel + initrd を含む）
- 誰が使う: QEMU（cdrom）→ GRUB

ISO の中身は、概ね `UmuOS-0.1.1/iso_root/` に対応する。

### 2) ISO内のブート資材（iso_root）

- パス: `UmuOS-0.1.1/iso_root/`
- 役割: ISO のルート（GRUB が直接参照する配置）
- 主な中身:
  - `iso_root/boot/grub/grub.cfg`
    - GRUB の設定（どの kernel / initrd を使うか、カーネル引数は何か）
    - `console=ttyS0,115200n8` 等の観測設計が入っている
  - `iso_root/boot/vmlinuz-6.18.1`
    - Linux カーネル（圧縮済み）
  - `iso_root/boot/initrd.img-6.18.1`
    - initramfs（early userspace）

補足: `grub.cfg` に `root=UUID=...` が書かれているため、
initramfs が終わった後の「本 root」は永続ディスク側（ext4）を想定している。

### 3) 永続ディスク

- パス: `UmuOS-0.1.1/disk/disk.img`
- 役割: 永続 root（ext4 の想定。再起動しても中身が残る）
- 誰が使う: Linux カーネル / initramfs（root=UUID の参照先）

### 4) UEFI NVRAM（OVMF VARS）

- パス: `UmuOS-0.1.1/run/OVMF_VARS_umuos_0_1_1.fd`
- 役割: UEFI の NVRAM 相当（QEMU 実行中に更新される）
- 誰が使う: OVMF（UEFI）

`UmuOS-0.1.1/umuOSstart.sh` は、ホストの `OVMF_VARS_4M.fd` をコピーして
このファイルを作り、以後それを使い回す運用になっている。

---

## initramfs（early userspace）の成果物

- ディレクトリ: `UmuOS-0.1.1/initramfs/`

### 1) initramfs 本体（アーカイブ／イメージ）

- `initramfs/initrd.cpio`
  - 役割: initramfs の実体（cpio アーカイブ）
- `initramfs/initrd.img-6.18.1`
  - 役割: kernel が読み込む initrd イメージ（ISO内に置くものと同系列）

※ このディレクトリには `*.list` / `*.filelist*` のような「生成のための中間成果物」もある。
後で「どう作られたか」を追うために残してある、と捉える。

### 2) rootfs（initramfsの展開イメージ）

- パス: `initramfs/rootfs/`
- 役割: initramfs の中身をディレクトリとして見える化したもの
- 主な観点:
  - `rootfs/init` が early userspace のエントリポイント
  - `proc/` `sys/` `dev/` などの mount 先がここに用意されている
  - `newroot/` は「永続 root に切り替える」ための作業場所になりがち

### 3) init のソース

- パス: `initramfs/src/init.c`
- 役割: initramfs 内で動く `/init` の実装（early userspace の責務を担う）

---

## カーネル成果物

- ディレクトリ: `UmuOS-0.1.1/kernel/`

### 1) カーネルツリー（ビルド後）

- パス: `kernel/linux-6.18.1/`
- 役割: カーネルソース + ビルド成果物一式（`vmlinux` や `.config` などが存在）

### 2) ISOへ配置されるファイル

- 代表例: `iso_root/boot/vmlinuz-6.18.1`, `iso_root/boot/config-6.18.1`
- 役割: 起動に使う kernel 本体と、観測・再現のための設定

---

## 起動スクリプト（ホスト側の成果物）

### 1) 起動用スクリプト

- パス: `UmuOS-0.1.1/umuOSstart.sh`
- 役割: QEMU+UEFI(OVMF) で UmuOS-0.1.1 を起動する手順を固定する
- 誰が使う: 開発者（ホスト側）

このスクリプトは、
「どこから実行してもプロジェクト直下基準」「失敗したら即止める」「OVMF_VARS を汚さない」
など、運用上の事故を避ける意図がコメント付きで埋め込まれている。

---

## 設計・実装ノート（成果物だが起動には直接不要）

- ディレクトリ: `UmuOS-0.1.1/docs/`
- 役割: 当時の設計判断、実装メモ、失敗と教訓を“資産”として残す

例:
- `基本設計書-0.1.1.md`
- `詳細設計-0.1.1.md`
- `実装ノート-0.1.1.md`
- `init_疑似コード版.md`

---

## ライセンス関連

- `UmuOS-0.1.1/LICENSE.md` / `LICENSE.GPLv3.md` / `NOTICE.md`
- 役割: 配布物に含まれるソフトウェアのライセンス条件・告知

---

## 次に深掘りするためのチェックポイント

この一覧を前提に、次の章で深掘りする時は以下を順に潰すと迷いにくい。

1. `iso_root/boot/grub/grub.cfg` のカーネル引数が、どの成果物を指しているか
2. initramfs の `/init` が、永続 root（disk.img）へどう繋ぐ設計になっているか
3. 永続 root に切り替わった後の init/rcS が何を担っているか
