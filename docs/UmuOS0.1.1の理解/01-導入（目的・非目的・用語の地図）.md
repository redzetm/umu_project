# 01-導入（目的・非目的・用語の地図）

UmuOS 0.1.1 を理解するとき、最初に必要なのは「仕組み」ではなく **地図**である。
ここで言う地図とは、

- UmuOS が何を目標にしている OS なのか
- 何を目標にしていないのか
- 起動を説明するときに避けて通れない用語が何か

を、初学者でも取り違えない形に固定することを指す。

## 1. UmuOS は何のための OS か

UmuOS 0.1.1 は、日常利用のための OS ではない。
このプロジェクトが一貫して強調しているのは「研究と観測のため」という立ち位置であり、
その結果として、構成が“便利さ”よりも“理解しやすさ”に寄る。

本書が重視するのは次の一点である。

> UmuOS は「動くこと」をゴールにするのではなく、
> 「なぜそう動くのかが見えること」をゴールにする。

この思想は、UmuOS 0.1.1 の README にも明示されている。

- 参照：`UmuOS-0.1.1/README.md`

## 2. UmuOS 0.1.1 のスコープ（本書の範囲）

UmuOS 0.1.1 は、OS 全体を“完成品”として作るのではなく、
「成立させたい最小の筋道」を強く意識している。

この本は、0.1.1 の成立条件である次の流れだけを、穴なく説明する。

- UEFI → GRUB → Linux kernel → initramfs（自作 `/init`）→ 永続 ext4（disk.img） → ユーザーランド

逆に、0.1.1 でスコープ外とされている機能（例：ネットワーク）は扱わない。

## 3. まず覚えるべき用語（地図の凡例）

ここでは最小限の定義をする。厳密さよりも「取り違えないこと」を優先する。

### 3.1 UEFI（ファームウェア）

PC の電源投入直後に動く、最初のソフトウェア。
OS よりも前に起動し、次の段階（ブートローダなど）に制御を渡す。

UmuOS 0.1.1 は QEMU 上で動かすが、QEMU でも UEFI を再現できる。
そのために OVMF を使う。

### 3.2 GRUB（ブートローダ）

UEFI と OS の間で、OS（Linux カーネル）をロードする役割を持つ。
GRUB は「どのカーネルを起動するか」「initrd をどれにするか」「カーネル引数を何にするか」を決める。

UmuOS 0.1.1 の GRUB 設定は `iso_root/boot/grub/grub.cfg` にある。

### 3.3 Linux カーネル

OS の中心。プロセス管理、メモリ管理、デバイス管理、ファイルシステムなどの基盤を提供する。
UmuOS 0.1.1 では Linux カーネルを利用し、その上のユーザーランド（init 以降）を自分の設計で組み立てている。

### 3.4 initramfs / initrd（early userspace）

Linux カーネルが起動直後に展開し、
「永続 root（disk.img）へ到達するまでの最初のユーザー空間」を提供する仕組み。

initramfs の中には `/init` という最初のプログラムがあり、
それが “永続 root を見つけて mount し、root を切り替え、ユーザーランドへ繋ぐ” 役割を担う。

UmuOS 0.1.1 では、この `/init` を C で自作している（後の章で解説する）。

### 3.5 root ファイルシステム（/）

OS が「ファイルシステムの根（ルート）」として扱う場所。
UmuOS 0.1.1 では最終的に `disk/disk.img`（ext4）が `/` になることがゴールである。

### 3.6 switch_root

initramfs の `/init` が実行する “root 切り替え” の仕組み。
これにより、initramfs を卒業して永続 root へ移り、`/sbin/init` を起動する。

UmuOS 0.1.1 の initramfs は BusyBox を含み、`/bin/switch_root` は BusyBox applet として提供される。

## 4. この本の到達目標

この本を読み終えたとき、次の問いに文章で答えられる状態を目指す。

- なぜ GRUB で `root=UUID=...` を渡しているのか
- initramfs の `/init` は何を入力として何を出力しているのか
- `/dev/disk/by-uuid` のような仕組みを使わずに、なぜ/どうやって root デバイスを特定できるのか
- `switch_root` の前と後で、PID 1 と `/` はどう変わるのか
- 永続性は何で担保され、どう観測できるのか

答えが「感覚」ではなく「手順＋理由」になっていることが、理解の完了条件になる。
