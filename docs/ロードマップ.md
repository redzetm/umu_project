# UmuOS のロードマップ（研究目的：起動・ログイン・権限・ネットワーク・観測）

この文書は、UmuOS を「実用OS」として完成させるための計画ではなく、
**OS を理解し、観測し、検証するための研究プロジェクトとしての到達目標**を整理するためのロードマップです。

- 目的：起動からログインまでの仕組み、ユーザーランド、権限、ネットワーク、セキュリティ上の必然性を“自分で説明できる”状態にする
- 手段：小さく実装し、観測点（ログ・再現手順）で到達を確定する
- 重要：機能の有無は「便利さ」ではなく「理解に寄与するか」で判断する

---

## 非目標（このロードマップが約束しないこと）

- 一般的な Linux ディストリビューションの代替
- インターネット公開を前提とした安全な運用
- セキュアな通信基盤の提供（ただし、なぜ必要かを研究する対象には含める）

---

## 用語（仕様のブレを防ぐための定義）

- **ホスト（host）**：UmuOS を動かす側の PC（開発機、Ubuntu 等）。QEMU/virt-manager、Wireshark、ビルド環境がある。
- **ゲスト（guest）**：ホスト上の仮想マシンの中で動く UmuOS 本体。
- **VMマネージャ（virt-manager / libvirt）**：仮想マシンの作成・起動・コンソール接続などを管理する仕組み。
- **ブリッジ接続（bridge）**：ゲストが LAN 上の「別マシン」のように見える接続方式（ゲストが LAN 内 IP を持つ）。
- **ユーザー数（アカウント数）**：`/etc/passwd` / `shadow` 等で定義されるアカウントの数
- **同時ログイン（同時セッション数）**：同時に存在できるログインセッションの数
- **入口（ログイン経路）**：ログインを受け付ける経路（例：VGA/tty0、シリアル、telnet、将来ssh）

ポイント：
- ユーザー数は増やしやすいが、同時ログインは「入口」と「OS資源」に依存する
- 同時ログインの上限は仕様として固定しない（CPU/メモリ/プロセス数/pty 等で決まる）

---

## フェーズ0：前提（研究としての成立条件）

- **再現性**：手順（ビルド〜起動〜観測）が文書化されている
- **観測性**：ホスト側ログとゲスト側ログの両方、または同等の観測点がある
- **巻き戻し可能性**：ネットワークが壊れても復旧できる入口（VGA/シリアル等）を残す

---

## フェーズ1：やりたいこと

このフェーズは「起動・ログイン・権限・ネットワーク・ユーザーランド・シェル」までを一通り理解するための段階です。

### きちんと起動すること

到達条件（例）：
- 起動手順が固定化され、再現できる
- 主要ログ（カーネルログ、init〜login のログ）が残る
- 永続ディスク等があれば、再起動しても状態が確認できる

観測対象（例）：
- 起動フロー（UEFI/GRUB → kernel → initramfs → switch_root → init → getty/login）

---

### マルチユーザー対応（同時ログイン）

仕様の整理：
- **ユーザー数（アカウント数）**：上限は固定しない（研究上は多数でもよい）
- **同時ログイン数**：上限は固定しない（入口方式と資源で決まる）
- **現バージョンでの受入**：まずは複数入口で同時ログインが成立することを確認する

到達条件（例）：
- 少なくとも2つ以上の入口で同時ログインができる（現時点の到達点として）
- 将来の拡張に備え、「入口」を増やす設計にできる（例：ネットワーク経由の多重化）

---

### `su` コマンドが利用できる

狙い：
- `uid/gid`、補助グループ、`setuid`、環境初期化等の理解

方針：
- 研究目的で導入するが、`setuid root` を含むため、範囲を最小化して扱う
- 実装/採用品目（busybox / util-linux / shadow 等）は、観測したい論点に合わせて選ぶ

到達条件（例）：
- 一般ユーザーから `su -` で root に切替でき、挙動を説明できる
- 危険性（なぜ難しいか、なぜ設計が要るか）を自分の言葉で整理できる

---

### telnetd の実装（ネットワークでアクセスできる）

位置づけ：
この項目は「実用的なリモートログイン環境の提供」を目的とせず、
平文通信を教材として観測・比較するための研究機能として扱います。

- telnet は「推奨運用」ではなく、**観測と比較のための教材**として導入する
- L2〜L7 を“中身が見える形”で観測することが目的

安全上の前提（研究でも必須）：
- 閉域（LAN 内）に限定し、外部公開しない
- 接続元（クライアント）を実質1台・固定条件に寄せる
- ネットワークだけに依存せず、VGA/シリアル等の復旧口を残す

到達条件（例）：
- LAN 内から telnet でログインできる
- パケットキャプチャで、意図した層（L2〜L7）を観測できる

---

### virt-manager（仮想マシンマネージャ）で起動でき、telnetで接続

狙い：
- QEMU 直叩き前提から、libvirt/virt-manager 前提へ拡張可能にする

ポイント：
- `-serial stdio` のような「起動端末直結」前提から卒業し、
  VM マネージャが提供する入口（VGA/シリアル）も成立させる
- telnet は研究用の運用口として位置づけ、コンソール入口を常に残す

補足：
- telnet は利便性のためではなく、キャプチャ観測（L2〜L7）を成立させるための研究用入口とする

到達条件（例）：
- virt-manager 上で起動できる
- VGA（画面）またはシリアル（管理コンソール）で確実にログインできる
- ブリッジ接続を前提に、LAN 内から telnet で接続できる

---

### 一般的なコマンド（BusyBox または自作）の利用

方針：
- 最初は BusyBox を中心に成立させ、必要に応じて自作コマンドを追加する
- 自作は「観測したい挙動がある時」に行い、目的を曖昧にしない

到達条件（例）：
- 最低限の管理に必要なコマンド群が動く
- コマンドの実装・依存・権限の考え方を説明できる

---

### `ush`（自作シェル）の実装

狙い：
- `fork/exec/wait`、リダイレクト、パイプ、TTY、ジョブ制御の理解

到達条件（例）：
- 最小シェルとしてコマンド実行ができる
- どの機能を実装していないか（非目標）を明示できる

---

## フェーズ2：OS を育てていくフェーズ（フェーズ1 の理解を前提）

ここからは、研究テーマを明確にした上で、比較・改良・拡張を行うフェーズです。
例：
- TELNET と SSH の比較（何が見えなくなるか、何が守られるか）
- 認証基盤（例：PAM）の導入動機の検証（ポリシー分離・拡張性・運用性）
- 同時セッション増加時の資源枯渇（プロセス/PTY/メモリ）の観測
- 入口（VGA/シリアル/ネットワーク）の整理と拡張

---

## 文書化ルール（ロードマップ運用）

- 1回の実験で変えるのは1点だけ
- 変更には必ず「観測点（ログ/手順/期待結果）」を付ける
- 危険な機能を扱う場合は、必ず「閉じる条件（範囲/想定/復旧口）」もセットで書く

