Step1プロジェクト 実装内容の説明

この手順を実装すると、QEMU上でUEFI起動可能なカスタムLinuxカーネル（6.6.58-custom）を含む
ブータブルISOイメージが作成されます。
このISOイメージは、systemdを含まない最小構成のinitramfs環境で動作し、
起動後にdracutの緊急シェルプロンプトが表示されるまでを確認できます。

全体の流れ
本プロジェクトは、以下の6つのステップで構成されています:

1. 環境準備
Ubuntu環境に必要な開発ツール、GRUB関連パッケージ、QEMU、initramfs作成ツールをインストールし、
作業用ディレクトリ構造を作成します。

2. カーネルビルド
Linux 6.6.58のソースコードをダウンロードし、デフォルト設定をベースにカスタムバージョン文字列（-custom）を
付加したカーネルをビルドします。ビルド後のカーネルイメージ（vmlinuz-6.6.58-custom）と
カーネル設定ファイル（.config）をISO作成用ディレクトリにコピーします。

3. initramfs作成
dracutツールを使用して、systemdを完全に除外したinitramfs（初期RAMファイルシステム）を生成します。
代わりにcoreutilsのコマンド群（ls, cat, mount等）を明示的に組み込み、QEMU/KVM環境用のvirtioドライバも追加します。
生成されたinitramfs（initrd.img-6.6.58-custom）もISO作成用ディレクトリにコピーします。

4. GRUB設定
UEFI起動用のGRUB設定ファイル（grub.cfg）を作成します。通常モードとデバッグモードの2つのメニューエントリを用意し、
カーネルパラメータにrd.shell（エラー時に緊急シェルを起動）とrd.debug（デバッグモードのみ、詳細ログ出力）を指定します。

5. ISOイメージ作成
grub-mkrescueコマンドを使用して、UEFI対応のブータブルISOイメージ（step1-boot.iso）を生成します。
このISOには、カーネル、initramfs、GRUB設定、およびUEFI起動に必要なEFIブートローダーが含まれます。

6. QEMU検証
OVMFファームウェアを使用してQEMU上でISOイメージを起動し、以下の動作を確認します

GRUBメニューの表示
カーネルの起動
initramfsの実行
緊急シェルプロンプト（dracut:/#）の表示
技術的なポイント
systemdの完全除外
この実装では、意図的にsystemdを除外しています。理由は以下の通りです

研究目的: Linuxブートプロセスの基礎を理解するため
最小構成: 不要な依存関係を排除し、起動プロセスを単純化
デバッグ容易性: 問題が発生した際の原因切り分けが容易
systemdを除外した結果、ログインプロンプトではなく、initramfsの緊急シェル（dracut:/#）が表示されます。
これは正常な動作であり、成功条件として定義した。

UEFI起動への対応
最新のPC/サーバー環境では、従来のBIOSに代わってUEFIが標準となっています。
本手順では、GRUB EFIブートローダーとOVMFファームウェアを使用することで、UEFI環境での起動を実現しています。

virtioドライバの組み込み
QEMU/KVM環境で高速なI/O性能を得るため、準仮想化ドライバであるvirtio（virtio_blk, virtio_scsi, virtio_pci）を
initramfsに組み込んでいます。

成功条件
この手順を正しく実装した場合、以下の動作が確認できます:

GRUBメニューの表示: QEMU起動後、タイムアウト10秒のGRUBメニューが表示される
カーネル起動ログ: シリアルコンソールにカーネルの起動ログ（dmesg相当）が表示される
緊急シェルプロンプト: dracut:/# プロンプトが表示される
基本コマンドの動作: シェル内で ls, cat, mount, lsmod 等のコマンドが動作する
ログの保存: logs/serial-YYYYMMDD-HHMMSS.log に起動ログが保存される
成果物
実装完了後、以下の成果物が生成されます:

最終成果物
step1-boot.iso: QEMU/実機で直接起動可能なブータブルISOイメージ（約100-200MB）
検証用ファイル
logs/serial-*.log: QEMU起動時のシリアルログ（トラブルシューティング用）
initramfs/initramfs-contents.txt: initramfsに含まれるファイル一覧
バックアップファイル
kernel/config-6.6.58-custom: カーネルビルド設定（再現性確保）
kernel/linux-6.6.58.tar.xz: ダウンロードしたカーネルソースアーカイブ

この手順の意義　研究価値

Linuxカーネルのビルド方法を習得できる
initramfsの仕組みと作成方法を理解できる
UEFI起動プロセスを学べる
QEMUによる仮想化検証手法を体験できる
実用性
カスタムLinux環境の構築基盤となる
組み込みシステム開発の基礎知識が身につく
トラブルシューティング能力が向上する
拡張性
この手順をベースに、以下のような発展が可能です:

独自のinitスクリプトによるカスタム起動プロセス
ルートファイルシステムの追加（実際のLinuxディストリビューション環境）
カーネルモジュールの追加・カスタマイズ
セキュリティ機能（Secure Boot等）の実装
想定される使用場面
教育・研究
Linuxカーネル開発の入門
システムプログラミング教材
オペレーティングシステム論の実習
開発・検証
カスタムLinuxディストリビューションの試作
組み込みシステムのプロトタイピング
カーネルドライバの開発・テスト環境
トラブルシューティング
起動不能システムのレスキュー環境
ハードウェア互換性の検証
ブートプロセスのデバッグ
注意事項
制限事項
永続ストレージなし: ISO起動環境のため、シャットダウン時にデータは失われます
ログインプロンプトなし: systemd除外により、通常のログイン画面は表示されません
ネットワーク設定なし: 最小構成のため、ネットワーク機能は含まれていません
必要な知識
基本的なLinuxコマンド操作
シェルスクリプトの読解
ファイルシステムの概念
所要時間
初回実装: 約1.5〜2時間（カーネルビルド時間を含む）
2回目以降: 約30分〜1時間
まとめ
この手順書は、ゼロからブータブルLinux環境を構築するという、システムプログラミングの基礎を体系的に学べる教材です。
手順通りに実装することで、Linuxの起動プロセスを深く理解し、カスタムシステム開発の基盤技術を習得できます。