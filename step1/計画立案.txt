Step1
目的とスコープ
- 目的：GRUBメニューを表示し、タイムアウトでデフォルトエントリを自動選択して、
　カスタム Linux 6 系カーネル を起動し、最終的にコンソールの
　ログインプロンプトを表示する。
- スコープ：GUIは対象外。コンソール画面と起動シーケンスの理解と再現を最優先とする。
　GRUB からのカーネルロード、initramfs の動作、root マウント、
　getty によるログインプロンプト表示までを含む。

前提条件
- プラットフォーム：x86_64 を想定。
- ブート方式：UEFI を利用。Secure Boot は無効化して署名なしで実装する。
- ブートローダ：GRUB2 系を使用（UEFI 用 grubx64.efi を配置）。
- 検証環境：QEMU（OVMF）で行う。OVMF 変数イメージは Secure Boot 無効のものを使用する。
- カーネル：Linux 6 系をベースにカスタムビルドした vmlinuz-<custom> を使用する想定。
　ビルド時の .config を成果物として保存する。
- initramfs：デフォルトで同梱する（initramfs を推奨）。
　必要に応じて最小構成の initramfs を作成する。
- コンソール設定：デバッグ用にカーネルコマンドラインへ 
　console=tty1 console=ttyS0,115200 を含めることを推奨。
- root 指定：root=UUID=<uuid> を推奨し、/etc/fstab も UUID を使用する。

成功条件（必須）
- GRUB メニューが起動時に表示されること。
- set timeout の秒数経過でデフォルトエントリが自動的に選択されること。
- GRUB が指定したカーネルイメージと initramfs をロードし、
　カーネルが制御を受け取ること。
- カーネル起動後に initramfs が必要な初期処理を行い、本来のルートファイルシステムへ
　移行すること（switch_root/pivot_root の成功）。
- 最終的にコンソール上にログインプロンプトが表示されること
　（getty が tty1 にバインドされていること）。
- 追加テスト基準：手動起動（Enter）での起動、タイムアウト自動起動の再現性（複数回）、
　カーネルログに VFS や root 関連のエラーがないこと、
　systemctl status getty@tty1 がアクティブであること（systemd 環境）。

成果物（必須）
- /boot/vmlinuz-<custom>：カスタムビルド済みカーネルイメージ（ビルド時の .config を含む）。
- /boot/initrd.img-<custom>：対応する initramfs（cpio 形式、内容一覧をドキュメント化）。
- /boot/grub/grub.cfg：メニュー定義とデフォルト設定を含む GRUB 設定ファイル
　（UEFI 配置パスを明記）。
- テスト用 ISO またはブート可能イメージ：QEMU 検証用
　（OVMF 変数イメージと合わせた起動手順を含む）。
- 設計ドキュメント：目的、前提、成功条件、検証手順、トラブルシュート手順、
　ログの読み方、よくある失敗パターンを含む。
- 追加成果物（推奨）：initramfs の中身リスト、
　GRUB メニューのスクリーンショット（ログ保存）、各段階のイメージスナップショット。

実装上の注意点と推奨設定
- GRUB の default と timeout：set default=0、set timeout=<秒数> を明示し、
　メニュー順とデフォルト番号をドキュメント化する。
- カーネルコマンドライン：
　root=UUID=<uuid> ro console=tty1 console=ttyS0,115200 を推奨。
　QEMU ではシリアルコンソールでログを取得する。
- initramfs の中身：ルートマウントに必要なモジュール
　（ストレージ、ファイルシステム、LVM、暗号化を使う場合は cryptsetup 等）を含める。
　最小構成は busybox ベースで可。
- UEFI 配置：ISO での検証時は grub-mkrescue や xorriso を使い、
　EFI ブートローダ（EFI/BOOT/BOOTX64.EFI）と EFI/BOOT/grub.cfg を正しく配置する。
- ログ保存：QEMU 起動時にシリアル出力をファイルにリダイレクトしてログを残す
　（例：-serial file:serial.log）。
- スナップショット運用：各段階でイメージのスナップショットを取り、
　ロールバック手順を明記する。
- セキュリティ：研究用に Secure Boot を無効化する場合は、
　ネットワーク分離や VM 内での実施を推奨。実機配布時は署名ワークフローを別途検討する。

テスト項目（チェックリスト）
- GRUB2 の UEFI ビルド（grubx64.efi）が用意されているか。
- OVMF（UEFI）イメージが Secure Boot 無効であるか。
- vmlinuz と initrd.img のペアが一致しているか。
- grub.cfg の menuentry 内で linux と initrd のパスが正しいか。
- カーネルの .config に必要ドライバが組み込まれているか（または initramfs に含めるか）。
- root= を UUID 指定にしているか。
- getty が有効で tty1 にログインプロンプトを出す設定になっているか。
- シリアルログがファイルに保存される設定になっているか。

決めるべき小項目（要確定）
- timeout の標準値（例：10〜25 秒）
- initramfs 作成方法：dracut を使うか、busybox ベースで自作するか
- デフォルトエントリ管理方法：手動で grub.cfg を編集する運用か、grub-mkconfig を使う運用か
- ログ取得方針：シリアルログのみか、画面キャプチャも取るか
- 実機検証の予定：将来的に実機での検証を行うか（行う場合は UEFI 設定手順を追加）

テストケース（具体例）
- TC-01：GRUB メニューが表示されるか（起動直後）。
- TC-02：timeout 経過でデフォルトエントリが自動起動するか（3 回連続で確認）。
- TC-03：手動でエントリを選択して起動できるか（Enter）。
- TC-04：カーネルが initramfs を読み込み、switch_root に成功するか（ログ確認）。
- TC-05：最終的に getty が起動しログインプロンプトが表示されるか。
- TC-06：起動ログに VFS / root 関連のエラーがないこと。
