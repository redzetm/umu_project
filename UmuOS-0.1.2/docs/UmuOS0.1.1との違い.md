# UmuOS 0.1.2 は 0.1.1 から何が変わったか（総括・まとめ）

作成日: 2026-01-12

この文書は、UmuOS-0.1.1 と UmuOS-0.1.2 の差分を「設計判断」「運用」「成果物」「観測（ログ）」の観点で整理し、0.1.2 を“戻れるベース版”として確定するための総括をまとめる。

参照（正本）:
- 0.1.1: [UmuOS-0.1.1/docs/基本設計書-0.1.1.md](../../UmuOS-0.1.1/docs/基本設計書-0.1.1.md), [UmuOS-0.1.1/docs/詳細設計-0.1.1.md](../../UmuOS-0.1.1/docs/詳細設計-0.1.1.md)
- 0.1.2: [UmuOS-0.1.2/docs/基本設計書-0.1.2.md](基本設計書-0.1.2.md), [UmuOS-0.1.2/docs/詳細設計書-0.1.2.md](詳細設計書-0.1.2.md), [UmuOS-0.1.2/docs/実装ノート0.1.2.md](実装ノート0.1.2.md)

---

## 1. 結論（0.1.2 の到達点）

- 0.1.2 は 0.1.1 と同じ粒度（Kernelビルド〜disk.img作成〜initramfs生成〜ISO生成〜起動〜受入）で **再生成できるベース版**として成立。
- 0.1.2 の主差分は「観測性の最小拡張」であり、**二系統ログ**を必須条件として設計・手順・実装ノートが揃った。
  - ①ホスト側ログ: QEMUシリアルを `logs/` にセッション保存（`script(1)`）
  - ②ゲスト側ログ: ext4 側の rcS が `/logs/boot.log` に「1ブート=1ブロック」で追記

---

## 2. 変えていないもの（0.1.1 と 0.1.2 の共通基盤）

- 成功の骨格（Phase 1 相当）は不変
  - UEFI → GRUB → kernel → initramfs（自作 `/init`）→ ext4（disk.img）へ `switch_root`
  - 最終 `/` は ext4（disk.img）
  - ttyS0 で `root`/`tama` がパスワードログイン
  - 永続性（再起動後もファイルが残る）
- 観測の主経路は ttyS0（`-nographic` + `-serial stdio`）
- Kernelバージョンは固定（6.18.1）
- initramfs の `/init` は C + musl静的リンク（方針として 0.1.1 を踏襲）
- ネットワークは受入範囲外（0.1.2 でも非ゴール）

---

## 3. 主要差分（一覧）

| 観点 | 0.1.1 | 0.1.2 |
|---|---|---|
| 位置づけ | 「戻れるベース（安定点）」を確定 | **0.1.1と同じ粒度で“最初から再現”できるベース** + 観測性最小拡張 |
| ログ（必須条件） | ttyS0 観測が主。`/logs/boot.log` は推奨（任意） | **二系統ログが必須**（①ホスト側セッション保存 + ②ゲスト側永続追記） |
| ①ホスト側ログ | 明確な必須化なし | `script(1)` で `logs/qemu-serial_YYYYmmdd_HHMMSS.log` を生成（一次証拠） |
| ②ゲスト側ログ | 任意（採用するなら rcS で） | rcS で `/logs/boot.log` 追記を標準化（失敗してもブート継続） |
| 手順の固定度 | 手順は正本化されているが、運用の混線に注意が必要 | **作業ルート固定**、正本（詳細設計書）を軸に「混線防止」を強化 |
| 変数運用 | 変更なし | `$UMU_ROOT` のような環境変数運用を避け、`~/umu/umu_project/UmuOS-0.1.2` に固定 |
| 受入チェック | Phase 1 が中心（永続ログは推奨） | Phase 1 + Phase 2（二系統ログ）までを **受入必須**へ引き上げ |

---

## 4. 0.1.2 の設計判断（なぜそうしたか）

### 4.1 「ログ二系統で、合流しない」

0.1.2 のログは、あえて合流しない（統合しない）。理由は以下。

- ①は「ホスト観測の一次証拠」
  - `switch_root` 前（UEFI/GRUB/kernel/initramfs）を確実に追跡できる
  - “止まった場所”の特定ができる
- ②は「起動できた回の永続スナップショット」
  - `switch_root` 後に ext4 が成立して初めて書ける
  - 起動後の状態（cmdline/mount/dmesg 等）を“再起動後も”残せる

統合（例: pstore で initramfs 時点の永続化）をやると、ログ機構自体が新しい故障点になりやすい。
0.1.2 では「最小拡張」の範囲を守り、確実性と責務分離を優先した。

### 4.2 失敗してもブートを止めない

- ② `/logs/boot.log` の追記は、失敗してもブート継続。
- ログは“成功条件の一部”ではあるが、ログ書き込み失敗によって原因解析が難しくなるのを避けるため、rcS は警告のみ。

---

## 5. 実装・運用の差分（手で詰まるポイント）

- **ホストコマンドをゲストに打たない**
  - `./umuOSstart.sh` 実行中の端末はゲストの ttyS0 を表示している（QEMUシリアル）。
  - ホスト側の `logs/` を見るときは別ターミナルで。
- 端末エミュレータ由来の制御シーケンス混入
  - `^[[6n` や `;5R` のような文字列がログに混入して見えることがある。
  - これはゲストの異常というより「端末→シリアルに流れた入力が `script` に記録されている」現象。
  - 成否判定とは切り分ける（必要なら端末設定で抑止する）。
- `reboot` の権限
  - `tama` では `reboot: Operation not permitted` になり得る。
  - 永続性確認の再起動は `root` で実施。

---

## 6. 総括（0.1.2 の価値）

- 0.1.1 は「ベースが成立した」こと自体が成果。
- 0.1.2 は「ベースの成立」に加え、**観測の一次証拠と永続証拠が常に残る**ように手順と成果物が揃った。

研究・観測目的のOSにおいては、
- “動いた”よりも
- “次も同じように動かせて、どこで何が起きたかが残る”
が価値になる。

0.1.2 はその観点で、0.1.1 を踏襲しつつ「観測性だけを最小で足した」版として整理できた。

---

## 7. まとめ（次に進むための前提として）

- 0.1.2 は「戻れるベース版」として固定してよい。
- 次に進む場合のおすすめ順序は以下。
  1) 端末由来の制御シーケンス混入を抑止（運用改善）
  2) 0.1.2 を基準点として、次の差分（例: コマンド追加、coreutils実験、ネットワーク検証）を **1回1変更**で進める
